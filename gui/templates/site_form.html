{% extends "base.html" %}

{% block title %}{{ 'Add' if mode == 'add' else 'Edit' }} Site - WP Multi-Updater{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5">
                <i class="bi bi-{% if mode == 'add' %}plus-circle{% else %}pencil{% endif %}"></i>
                {{ 'Add New Site' if mode == 'add' else 'Edit Site' }}
            </h1>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="name" class="form-label">Site Name *</label>
                            <input type="text" class="form-control" id="name" name="name"
                                   value="{{ site.name or '' }}" required
                                   pattern="[a-z0-9-]+" title="Lowercase letters, numbers, and hyphens only"
                                   placeholder="example-staging">
                            <small class="form-text text-muted">
                                Unique identifier (lowercase-with-dashes)
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="host" class="form-label">Server IP/Host *</label>
                            <input type="text" class="form-control" id="host" name="host"
                                   value="{{ site.host or '' }}" required
                                   placeholder="123.45.67.89">
                            <small class="form-text text-muted">
                                Cloudways server IP address
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="user" class="form-label">SSH User *</label>
                            <input type="text" class="form-control" id="user" name="user"
                                   value="{{ site.user or '' }}" required
                                   placeholder="master_abc123">
                            <small class="form-text text-muted">
                                SSH/SFTP username from Cloudways
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="path" class="form-label">Application Path *</label>
                            <input type="text" class="form-control" id="path" name="path"
                                   value="{{ site.path or '' }}" required
                                   placeholder="/home/master/applications/abc123/public_html">
                            <small class="form-text text-muted">
                                Full path to WordPress installation
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="url" class="form-label">Site URL *</label>
                            <input type="url" class="form-control" id="url" name="url"
                                   value="{{ site.url or '' }}" required
                                   placeholder="https://example.com">
                            <small class="form-text text-muted">
                                Public URL for HTTP health checks
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="wp_cli" class="form-label">WP-CLI Command</label>
                            <input type="text" class="form-control" id="wp_cli" name="wp_cli"
                                   value="{{ site.wp_cli or 'wp' }}"
                                   placeholder="wp">
                            <small class="form-text text-muted">
                                Usually just "wp", sometimes /usr/local/bin/wp
                            </small>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('sites_list') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> {{ 'Add Site' if mode == 'add' else 'Save Changes' }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle"></i> How to Get Site Details
                    </h5>
                </div>
                <div class="card-body">
                    <h6>From Cloudways Dashboard:</h6>
                    <ol class="small">
                        <li>Go to <strong>Applications</strong></li>
                        <li>Select your app</li>
                        <li>Click <strong>Access Details</strong></li>
                        <li>Copy:
                            <ul>
                                <li>SSH/SFTP Username</li>
                                <li>Application Path</li>
                            </ul>
                        </li>
                        <li>Go to <strong>Servers</strong></li>
                        <li>Copy <strong>Public IP</strong></li>
                    </ol>

                    <hr>

                    <h6>Test SSH Access:</h6>
                    <pre class="small bg-white p-2"><code>ssh -i ~/.ssh/id_rsa_cloudways \
  user@host \
  "cd /path && wp core version"</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
